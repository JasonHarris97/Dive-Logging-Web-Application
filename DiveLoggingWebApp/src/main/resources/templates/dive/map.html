<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      	  layout:decorate="~{layouts/default}"
	    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
	<title>Dive World Map</title>
	<link th:href="@{/css/diveQuery.css}" type="text/css" rel="stylesheet" />
</head>

<body>
	<!-- MAIN -->
	<div layout:fragment="content">

		<div id="queryContainer">
			<form th:object="${query}" th:action="@{/dive/query}" method="post">
				<div th:classappend="${param.error}? has-error">
					<input placeholder="Search for dives..." type="text" name="inputString" id="inputString" th:field="*{inputString}">
					<button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
				</div>
				<div class="radioContainer">
					<h3>Search by:</h3>
					<label class="container">Username
					  <input type="radio" checked="checked" name="searchOption" th:field="*{searchOption}" th:value="username">
					  <span class="checkmark"></span>
					</label>
					<label class="container">Country
					  <input type="radio" name="searchOption" th:field="*{searchOption}" th:value="country">
					  <span class="checkmark"></span>
					</label>
					<label class="container">Date
					  <input type="radio" name="searchOption" th:field="*{searchOption}" th:value="date">
					  <span class="checkmark"></span>
					</label>
					<label class="container">Location
					  <input type="radio" name="searchOption" th:field="*{searchOption}" th:value="location">
					  <span class="checkmark"></span>
					</label>
					<label class="container">PADI Level
					  <input type="radio" name="searchOption" th:field="*{searchOption}" th:value="padiLevel">
					  <span class="checkmark"></span>
					</label>
				</div>
				<input type="hidden" name="source" th:value="map">
			</form>
		</div>
		
		<div id='map'></div>

		<script th:inline="javascript">	
		/*<![CDATA[*/
			L.mapbox.accessToken = 'pk.eyJ1IjoiamFzb24zeXAiLCJhIjoiY2s3ZW4waXl2MHo0MzNucGF4NHQ5bXZ4diJ9.P93UqztpQcrq70aYz1XETQ';

			var i;
			var diveList = [[${returnedDives}]];
			var longitude, latitude, diveTitle, diveSite, divePurpose, diveCountry, diverName, date; 

			var map = L.mapbox.map('map')
			    .setView([0.0, 0.0], 2)
			    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));
			

			for(i = 0; i < diveList.length; i++){
				longitude = diveList[i].longitude;
				latitude = diveList[i].latitude;
				diveTitle = diveList[i].diveTitle;
				diveCountry = diveList[i].country;
				diveSite = diveList[i].diveSite;
				divePurpose = diveList[i].divePurpose;
				diverName = diveList[i].diveOwner.firstName + " " + diveList[i].diveOwner.lastName;
				date = diveList[i].date;

				var marker = L.marker([latitude, longitude], {
								icon: L.mapbox.marker.icon({
									'marker-size': 'large',
									'marker-symbol': 'circle',
									'marker-color': '#4169E1'
								    	})
								})

				marker.bindPopup("<p>Title: "+diveTitle+"<br />Diver: "+diverName+"<br />Country: "+diveCountry+
							"<br />Site: "+diveSite+"<br />Purpose: "+divePurpose+"<br />Date: "+date+"</p>");
				marker.addTo(map);
			}
		/*]]>*/
		</script>
	</div>
	<!-- MAIN -->
</body>

</html>
