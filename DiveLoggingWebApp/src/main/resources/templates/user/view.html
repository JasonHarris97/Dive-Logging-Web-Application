<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      	  layout:decorate="~{layouts/default}"
	    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
	<title>User View</title>
</head>


<body>
	<!-- MAIN -->
	<div layout:fragment="content">

		<div class="tab">
			<button class="tablinks" onclick="openGenericTab(event, 'Overview')"  id="defaultOpen">Overview</button>
			<button class="tablinks" onclick="openGenericTab(event, 'DiveHistory')">Dive History</button>
			<button class="tablinks" onclick="openGenericTab(event, 'DiveMap')">Map</button>
			<button class="tablinks" onclick="openGenericTab(event, 'Images')">Images</button>
		</div>




		<!-- First Tab -->
		<div id="Overview" class="tabcontent">
			<div class="profile-top-banner">
				<img class="profile-picture" th:if="${returnedUser.profilePicture != null}" th:src="@{'/getImage/'+${returnedUser.profilePicture.id}}">

				<div class="profile-details">
					<h1 th:text="${returnedUser.username}"></h1>
					<p th:text="${returnedUser.fullName}"></p>
					<p th:text="${returnedUser.country}"></p>	
				</div>
			</div>
			
			<div class="profile-left-banner">
				<h1>Details</h1>
				
				<table>
					<tr>
						<td>Name:</td>
						<td th:text="${returnedUser.fullName}"></td>
					</tr>
					<tr>
						<td>Country:</td>
						<td th:text="${returnedUser.country}"></td>
					</tr>
					<tr>
						<td>No. of Dives:</td>
						<td th:text="${returnedUser.noOfDives}"></td>
					</tr>
					<tr>
						<td>Padi Level</td>
						<td th:text="${returnedUser.padiLevel}"></td>
					</tr>
					<tr>
						<td>Padi No</td>
						<td th:text="${returnedUser.padiNo}"></td>
					</tr>
					<tr>
						<td>Email:</td>
						<td th:text="${returnedUser.email}"></td>
					</tr>
					<tr>
						<td>Contact No:</td>
						<td th:text="${returnedUser.contactNumber}"></td>
					</tr>
				</table>
			</div>

			<div class="profile-right-banner">
				<div class="profile-recent-dive">
					<h1>Most Recent Dive</h1>

					<p th:if="${mostRecentDive != null}" th:text="${mostRecentDive.date}"></p>
					<p th:if="${mostRecentDive != null}" th:text="${mostRecentDive.country}"></p>
					<a class="viewlog-button" th:if="${mostRecentDive != null}" th:href="@{'/dive/view/'+${mostRecentDive.id}}">View Log</a>
					<p th:if="${mostRecentDive == null}">No logged dives!</p>
					<div class="profile-recent-images">
					<span th:if="${mostRecentDive != null}"><img class="recent-picture float-left" th:if="${mostRecentDive.images.size() gt 0}" th:src="@{'/getImage/'+${mostRecentDive.images.get(0).id}}"></span>
					<span th:if="${mostRecentDive != null}"><img class="recent-picture float-right" th:if="${mostRecentDive.images.size() gt 1}" th:src="@{'/getImage/'+${mostRecentDive.images.get(1).id}}"></span>
					</div>
				</div>
			</div>
		</div>





		<!-- Second Tab -->
		<div id="DiveHistory" class="tabcontent">
			<!-- Table -->
			<table id="myTable" class="resultsTable">
				<tr class="header">
					<th class="detailsCol">Details</th>
					<th class="dateCol">Date</th>
					<th>Diver Username</th>
					<th>PADI Level</th>
					<th class="participantsCol">Participants</th>
					<th>Country</th>
					<th>Location</th>
				</tr>
				<div th:if="${not #lists.isEmpty(returnedDives)}" >
					<tr th:each="d : ${returnedDives}">
						<td class="green-button"><a th:href ="@{'/dive/view/'+${d.id}}" th:text="View">Link</a></td>
						<td th:text="${d.date}">Date</td>
						<td><a th:href ="@{'/user/view/'+${d.diveOwner.username}}" th:text="${d.diveOwner.username}">Dive Owner Username</td>
						<td th:text="${d.diveOwner.padiLevel}">Dive Owner PADI Level</td>
						<td th:text="${d.noOfParticipants}">No. of Participants</td>
						<td th:text="${d.country}">Dive Country</td>
						<td th:text="${d.location}">Dive Location</td>
					</tr>
				</div>
				<div th:if="${#lists.isEmpty(returnedDives)}">
					<tr id="empty-results"></tr>
					<script>
						document.getElementById("empty-results").innerHTML = "No dives for this query";
					</script>
				</div>
			</table>
		</div>

		<!-- Third Tab -->
		<div id="DiveMap" class="tabcontent">
			<div id='map' class="profile-map"></div>
			<script th:inline="javascript">
			/*<![CDATA[*/
				L.mapbox.accessToken = 'pk.eyJ1IjoiamFzb24zeXAiLCJhIjoiY2s3ZW4waXl2MHo0MzNucGF4NHQ5bXZ4diJ9.P93UqztpQcrq70aYz1XETQ';
				var longitude, latitude, diveTitle, diveSite, divePurpose, diveCountry, diverName, date, diveID, diveLink, marker; 

				var map = L.mapbox.map('map')
				    .setView([0, 0], 2)
				    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'))

				/*[# th:each="d : ${returnedDives}"]*/
					longitude = /*[[${d.longitude}]]*/ 0;
					latitude = /*[[${d.latitude}]]*/ 0;
					diveTitle = /*[[${d.diveTitle}]]*/ "null";
					diveCountry = /*[[${d.country}]]*/ "null";
					diveSite = /*[[${d.diveSite}]]*/ "null";
					divePurpose = /*[[${d.divePurpose}]]*/ "null";
					detailedLocation = /*[[${d.detailedLocation}]]*/ "null";
					diverName = /*[[${d.diveOwner.firstName}+' '+${d.diveOwner.lastName}]]*/ "null";
					date = /*[[${d.date}]]*/ "null";

					diveID = /*[[${d.id}]]*/ 1;
					diveLink = "/dive/view/"+diveID.toString();
					console.log(diveLink);

					marker = L.marker([latitude, longitude], {
					icon: L.mapbox.marker.icon({
						'marker-size': 'small',
						'marker-symbol': 'circle',
						'marker-color': '#e60000'
					    	})
					})

					marker.bindPopup("<p>Title: "+diveTitle+"<br />Diver: "+diverName+"<br />Country: "+diveCountry+
							"<br />Site: "+diveSite+"<br />Purpose: "+divePurpose+"<br />Date: "+date+"</p>"+
							"<p>Link: <a href='" + diveLink +"'>View Log</a></p>");


					marker.addTo(map);
				/*[/]*/
			/*]]>*/
			</script>
		</div> 

		<!-- Fourth Tab -->
		<div id="Images" class="tabcontent">
			<div th:each="d : ${returnedDives}">
				<div class="dive-image-container" th:each="i : ${d.images}">
					<img class="dive-image" th:src="@{'/getImage/'+${i.id}}">
				</div>
			</div>
		</div>
	</div>
	<!-- MAIN -->
</body>

</html>

